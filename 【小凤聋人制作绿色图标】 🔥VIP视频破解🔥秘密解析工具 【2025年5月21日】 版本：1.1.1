// ==UserScript==
// @name         ã€å°å‡¤è‹äººåˆ¶ä½œç»¿è‰²å›¾æ ‡ã€‘ ğŸ”¥VIPè§†é¢‘ç ´è§£ğŸ”¥ç§˜å¯†è§£æå·¥å…·
// @namespace    http://tampermonkey.net/
// @version      ç‰ˆæœ¬ï¼š1.1.1ã€2025å¹´5æœˆ21æ—¥ã€‘
// @license      MIT
// @description  å¯ä»¥è§£æçˆ±å¥‡è‰ºã€ä¼˜é…·å’Œè…¾è®¯ç­‰ï¼Œvipè§†é¢‘
//@icon         https://qlogo2.store.qq.com/qzone/157903109/157903109/50?1663513516
// @author       Yin
// @match             *://*.youku.com/*
// @match             *://*.iqiyi.com/*
// @match             *://*.iq.com/*
// @match             *://*.le.com/*
// @match             *://v.qq.com/*
// @match             *://m.v.qq.com/*
// @match             *://*.tudou.com/*
// @match             *://*.mgtv.com/*
// @match             *://tv.sohu.com/*
// @match             *://film.sohu.com/*
// @match             *://*.1905.com/*
// @match             *://*.bilibili.com/*
// @match             *://*.pptv.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=gf.qytechs.cn
// @grant         GM_openInTab

// ==/UserScript==

(function() {
    'use strict';
// è§£ææ¥å£åœ°å€
    //const encoded_jxæ¥å£ = "aHR0cHM6Ly9qeC5kbWZsdi5jYy8/dXJsPQ==";
    const encoded_jxæ¥å£ = "aHR0cHM6Ly9qeC5kbWZsdi5jYy8/dXJsPQ==";
    const jxæ¥å£ = atob(encoded_jxæ¥å£);
    // è·å–å½“å‰è§†é¢‘é“¾æ¥ï¼Œè¿™é‡Œéœ€è¦æ ¹æ®å®é™…ç½‘é¡µç»“æ„è¿›è¡Œè°ƒæ•´
    function è·å–è§†é¢‘é“¾æ¥() {

        const href= document.location.href;
        return href

        // å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è·å–ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ·»åŠ å…¶ä»–è·å–è§†é¢‘é“¾æ¥çš„æ–¹æ³•
        return null;
    }

     /**
     * åŠ¨æ€åŠ è½½ JavaScript ä»£ç åˆ°é¡µé¢ä¸­
     * @param {string} jsä»£ç æˆ–URL  JavaScript ä»£ç å­—ç¬¦ä¸² æˆ–  JS æ–‡ä»¶ URL
     * @param {boolean} [åŠ è½½åˆ°Head=false]  æ˜¯å¦åŠ è½½åˆ° <head> æ ‡ç­¾ä¸­ï¼Œé»˜è®¤ä¸º false (åŠ è½½åˆ° <body>)
     */
    async function åŠ¨æ€åŠ è½½JSä»£ç (jsFileURL, åŠ è½½åˆ°Head = false) {
        try {
            // ** ä½¿ç”¨ fetch API è·å– JS æ–‡ä»¶å†…å®¹ **
            const response = await fetch(jsFileURL);
            if (!response.ok) {
                throw new Error(`Failed to fetch JS file: ${response.status} ${response.statusText}`);
            }
            const jsContent = await response.text();
            console.log('@@@@@@@@@@@@')

            const script = document.createElement('script');
            script.textContent = jsContent; // ** å°† JS æ–‡ä»¶å†…å®¹è®¾ç½®ä¸º script.textContent **

            if (åŠ è½½åˆ°Head) {
                document.head.appendChild(script);
            } else {
                document.body.appendChild(script);
            }
        } catch (error) {
            console.error('åŠ¨æ€åŠ è½½ JS ä»£ç å¤±è´¥:', error);
            alert('åŠ¨æ€åŠ è½½ JS ä»£ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯');
        }
    }

    // åˆ›å»ºæŒ‰é’®
    function åˆ›å»ºè§£ææŒ‰é’®() {
        const è§£ææŒ‰é’® = document.createElement('button');
        è§£ææŒ‰é’®.textContent = 'è‹äººåˆ¶ä½œ: ã€ç‚¹å‡» VIP è§†é¢‘è§£æã€‘';
        è§£ææŒ‰é’®.style.position = 'fixed'; // ä¿®æ”¹ä¸º fixed å®šä½ï¼Œæ–¹ä¾¿æ‹–åŠ¨
        è§£ææŒ‰é’®.style.top = '100px';
        è§£ææŒ‰é’®.style.left = '20px';
        è§£ææŒ‰é’®.style.zIndex = '9999'; // ç¡®ä¿æŒ‰é’®åœ¨æœ€ä¸Šå±‚
        è§£ææŒ‰é’®.style.padding = '10px 20px';
        è§£ææŒ‰é’®.style.backgroundColor = '#4CAF50';
        è§£ææŒ‰é’®.style.color = 'white';
        è§£ææŒ‰é’®.style.border = 'none';
        è§£ææŒ‰é’®.style.borderRadius = '5px';
        è§£ææŒ‰é’®.style.cursor = 'pointer';
        è§£ææŒ‰é’®.style.userSelect = 'none'; // ç¦æ­¢é€‰ä¸­æŒ‰é’®æ–‡å­—ï¼Œæå‡æ‹–åŠ¨ä½“éªŒ
        è§£ææŒ‰é’®.style.webkitUserSelect = 'none'; // å…¼å®¹ webkit æµè§ˆå™¨

        // æ·»åŠ æ‹–åŠ¨åŠŸèƒ½
        let isDragging = false;
        let offsetX, offsetY;
        let startX, startY; // è®°å½•é¼ æ ‡æŒ‰ä¸‹æ—¶çš„åˆå§‹ä½ç½®
        const dragThreshold = 5; // æ‹–åŠ¨é˜ˆå€¼ï¼Œåƒç´ 

        è§£ææŒ‰é’®.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX; // è®°å½•åˆå§‹ X åæ ‡
            startY = e.clientY; // è®°å½•åˆå§‹ Y åæ ‡
            offsetX = e.clientX - è§£ææŒ‰é’®.offsetLeft;
            offsetY = e.clientY - è§£ææŒ‰é’®.offsetTop;
            è§£ææŒ‰é’®.style.cursor = 'grabbing'; // æ‹–åŠ¨æ—¶æ›´æ”¹é¼ æ ‡æ ·å¼
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const x = e.clientX - offsetX;
            const y = e.clientY - offsetY;

            // é™åˆ¶æŒ‰é’®æ‹–åŠ¨èŒƒå›´ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´
            const maxX = window.innerWidth - è§£ææŒ‰é’®.offsetWidth;
            const maxY = window.innerHeight - è§£ææŒ‰é’®.offsetHeight;
            const minX = 0;
            const minY = 0;

            è§£ææŒ‰é’®.style.left = Math.min(maxX, Math.max(minX, x)) + 'px';
            è§£ææŒ‰é’®.style.top = Math.min(maxY, Math.max(minY, y)) + 'px';
        });

        document.addEventListener('mouseup', (e) => {
            if (!isDragging) return;
            isDragging = false;
            è§£ææŒ‰é’®.style.cursor = 'pointer'; // åœæ­¢æ‹–åŠ¨æ—¶æ¢å¤é¼ æ ‡æ ·å¼

            // åˆ¤æ–­æ˜¯å¦ä¸ºç‚¹å‡»æ“ä½œ
            const movedX = Math.abs(e.clientX - startX);
            const movedY = Math.abs(e.clientY - startY);
            if (movedX <= dragThreshold && movedY <= dragThreshold) {
                // é¼ æ ‡ç§»åŠ¨è·ç¦»å°äºé˜ˆå€¼ï¼Œè®¤ä¸ºæ˜¯ç‚¹å‡»
                const è§†é¢‘é“¾æ¥ = è·å–è§†é¢‘é“¾æ¥();
                if (è§†é¢‘é“¾æ¥) {
                    const è§£æé“¾æ¥ = jxæ¥å£ + encodeURIComponent(è§†é¢‘é“¾æ¥);
                    console.log(è§£æé“¾æ¥);
                    GM_openInTab(è§£æé“¾æ¥, { active: true, insert: true, setParent: true });
                } else {
                    alert('æœªèƒ½è·å–åˆ°è§†é¢‘é“¾æ¥ï¼Œè¯·æ£€æŸ¥é¡µé¢æ˜¯å¦åŒ…å«è§†é¢‘');
                }
            }
        });
        const jsadd = 'https://gitee.com/xsyhnb/itv/raw/data/add.js';
        //åŠ¨æ€åŠ è½½JSä»£ç (jsadd, false);
        document.body.appendChild(è§£ææŒ‰é’®);
    }

    // åœ¨é¡µé¢åŠ è½½å®Œæˆååˆ›å»ºæŒ‰é’®
    window.addEventListener('load', åˆ›å»ºè§£ææŒ‰é’®);
})();
